<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>CSVè³‡æ–™å»ºç«‹å·¥å…·</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      margin: 32px;
    }
    form {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-evenly;
    }
    form p {
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
    }
    input {
      font-size: 16px;
      padding: 4px;
    }
    button {
      background: #444;
      color: #fff;
      font-size: 16px;
      padding: 8px 16px;
      border: none;
      border-radius: 8px;
      margin-right: 8px;
      cursor: pointer;
    }
    .results {
      margin-top: 16px;
    }
    .results table {
      width: 100%;
      border-collapse: collapse;
      border: 1px solid #333;
      margin-top: 16px;
    }
    th,
    td {
      text-align: center;
      padding: 4px;
      border: 1px solid #333;
    }
  </style>
</head>
<body>
  <h1>ğŸ“ è³‡æ–™è¼¸å…¥èˆ‡CSVåŒ¯å‡º</h1>

  <form class="form">
    <p><label>æ—¥æœŸï¼š<input type="date" name="day" required /></label></p>
    <p><label>æ™‚é–“ï¼š<input type="time" name="time" required /></label></p>
    <p><label>åç¨±ï¼š<input type="text" name="name" id="name" required /></label></p>
    <p><label>é‡‘é¡ï¼š<input type="number" name="cost" required /></label></p>

    <p>
    <label>é¡åˆ¥ï¼š
      <select name="genre" required>
        <option value="">è«‹é¸æ“‡</option>
        <option>é¤é£²</option>
        <option>æ—¥ç”¨å“</option>
        <option>äº¤é€š</option>
        <option>æ°´é›»ç“¦æ–¯</option>
        <option>é€šè¨Šè²»</option>
        <option>ä½å®…</option>
        <option>æœé£¾</option>
        <option>æ±½è»Š</option>
        <option>ä¼‘é–’å¨›æ¨‚</option>
        <option>ç¾å®¹</option>
        <option>äº¤éš›</option>
        <option>æ›¸ç±</option>
        <option>ä¿éšª</option>
        <option>ç¨…é‡‘</option>
        <option>é†«ç™‚è²»</option>
        <option>æ•™è‚²</option>
        <option>æ‰‹çºŒè²»</option>
        <option>è¨‚é–±æœå‹™</option>
        <option>å’–å•¡</option>
        <option>æ—…éŠ</option>
        <option>è¨ˆç¨‹è»Š</option>
        <option>è½‰å¸³æ‰‹çºŒè²»</option>
      </select>
    </label>
    </p>

    <p><button type="submit">æ–°å¢</button></p>
  </form>

  <div class="results">
    <button class="exportBtn">åŒ¯å‡ºCSV</button>
    <button class="editSaveBtn">å„²å­˜ç·¨è¼¯</button>
    <table>
      <thead>
        <tr>
          <th>æ—¥æœŸ</th>
          <th>æ™‚é–“</th>
          <th>åç¨±</th>
          <th>é‡‘é¡</th>
          <th>é¡åˆ¥</th>
        </tr>
      </thead>
      <tbody class="tbody">
        <!-- è³‡æ–™æœƒè‡ªå‹•æ–°å¢åœ¨é€™è£¡ -->
      </tbody>
    </table>
  </div>

  <script>
    const form = document.querySelector(".form");
    const exportBtn = document.querySelector(".exportBtn");
    const editSaveBtn = document.querySelector(".editSaveBtn");
    const tbody = document.querySelector(".tbody");

    const APP = {
      data: [],
      init() {
        APP.addListeners();
      },
      addListeners() {
        form.addEventListener("submit", APP.saveData);
        exportBtn.addEventListener("click", APP.exportData);
        tbody.addEventListener("dblclick", APP.editCell);
      },
      saveData(e) {
        e.preventDefault();
        const formData = new FormData(form);
        APP.cacheData(formData);
        APP.buildRow(formData);
        form.reset();
        document.querySelector("#name").focus();
      },
      cacheData(formData) {
        APP.data.push(Array.from(formData.values()));
      },
      buildRow(formData) {
        const tr = document.createElement("tr");
        tr.setAttribute("data-row", document.querySelectorAll("tbody tr").length);
        let col = 0;
        for (let entry of formData.entries()) {
          tr.innerHTML += `<td data-col="${col}" data-name="${entry[0]}">${entry[1]}</td>`;
          col++;
        }
        tbody.append(tr);
      },
      exportData() {
        const headers = ["day", "time", "name", "cost", "genre"];
        const csvRows = [headers];
        APP.data.forEach((row) => {
          csvRows.push(row);
        });
        const csvString = csvRows.map(row =>
          row.map(col => col).join(",")
        ).join("\n");
        const fileName = `è³‡æ–™_${Date.now()}.csv`;
        const file = new Blob([csvString], { type: "text/csv;charset=utf-8;" });
        const a = document.createElement("a");
        a.href = URL.createObjectURL(file);
        a.download = fileName;
        a.click();
      },
      editCell(e) {
        let cell = e.target.closest("td");
        if (cell) {
          let row = +cell.parentElement.getAttribute("data-row");
          let col = +cell.getAttribute("data-col");
          cell.contentEditable = true;
          cell.focus();
          editSaveBtn.addEventListener("click", () => {
            APP.data[row][col] = cell.textContent;
            console.table(APP.data);
          });
        }
      }
    };

    document.addEventListener("DOMContentLoaded", APP.init);
  </script>
</body>
</html>
