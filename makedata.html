<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>CSVãƒ‡ãƒ¼ã‚¿ä½œæˆãƒ„ãƒ¼ãƒ«</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      margin: 32px;
    }
    form {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-evenly;
    }
    form p {
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
    }
    input {
      font-size: 16px;
      padding: 4px;
    }
    button {
      background: #444;
      color: #fff;
      font-size: 16px;
      padding: 8px 16px;
      border: none;
      border-radius: 8px;
      margin-right: 8px;
      cursor: pointer;
    }
    .results {
      margin-top: 16px;
    }
    .results table {
      width: 100%;
      border-collapse: collapse;
      border: 1px solid #333;
      margin-top: 16px;
    }
    th,
    td {
      text-align: center;
      padding: 4px;
      border: 1px solid #333;
    }
  </style>
</head>
<body>
  <h1>ğŸ“ ãƒ‡ãƒ¼ã‚¿å…¥åŠ›ã¨CSVå‡ºåŠ›</h1>

  <form class="form">
    <p><label>æ—¥ä»˜ï¼š<input type="date" name="day" required /></label></p>
    <p><label>æ™‚é–“ï¼š<input type="time" name="time" required /></label></p>
    <p><label>åç§°ï¼š<input type="text" name="name" id="name" required /></label></p>
    <p><label>é‡‘é¡ï¼š<input type="number" name="cost" required /></label></p>

    <p>
    <label>ã‚«ãƒ†ã‚´ãƒªï¼š
      <select name="genre" required>
        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
        <option>é£²é£Ÿ</option>
        <option>æ—¥ç”¨å“</option>
        <option>äº¤é€š</option>
        <option>æ°´é“ãƒ»é›»æ°—ãƒ»ã‚¬ã‚¹</option>
        <option>é€šä¿¡è²»</option>
        <option>ä½å®…</option>
        <option>è¡£é¡</option>
        <option>è»Šä¸¡</option>
        <option>å¨¯æ¥½</option>
        <option>ç¾å®¹</option>
        <option>äº¤éš›</option>
        <option>æ›¸ç±</option>
        <option>ä¿é™º</option>
        <option>ç¨é‡‘</option>
        <option>åŒ»ç™‚è²»</option>
        <option>æ•™è‚²</option>
        <option>æ‰‹æ•°æ–™</option>
        <option>ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³</option>
        <option>ã‚«ãƒ•ã‚§</option>
        <option>æ—…è¡Œ</option>
        <option>ã‚¿ã‚¯ã‚·ãƒ¼</option>
        <option>æŒ¯è¾¼æ‰‹æ•°æ–™</option>
      </select>
    </label>
    </p>

    <p><button type="submit">è¿½åŠ </button></p>
  </form>

  <div class="results">
    <button class="exportBtn">CSVå‡ºåŠ›</button>
    <button class="editSaveBtn">ç·¨é›†ã‚’ä¿å­˜</button>
    <table>
      <thead>
        <tr>
          <th>æ—¥ä»˜</th>
          <th>æ™‚é–“</th>
          <th>åç§°</th>
          <th>é‡‘é¡</th>
          <th>ã‚«ãƒ†ã‚´ãƒª</th>
        </tr>
      </thead>
      <tbody class="tbody">
        <!-- ãƒ‡ãƒ¼ã‚¿ãŒã“ã“ã«è¿½åŠ ã•ã‚Œã¾ã™ -->
      </tbody>
    </table>
  </div>

  <script>
    const form = document.querySelector(".form");
    const exportBtn = document.querySelector(".exportBtn");
    const editSaveBtn = document.querySelector(".editSaveBtn");
    const tbody = document.querySelector(".tbody");

    const APP = {
      data: [],
      init() {
        APP.addListeners();
      },
      addListeners() {
        form.addEventListener("submit", APP.saveData);
        exportBtn.addEventListener("click", APP.exportData);
        tbody.addEventListener("dblclick", APP.editCell);
      },
      saveData(e) {
        e.preventDefault();
        const formData = new FormData(form);
        APP.cacheData(formData);
        APP.buildRow(formData);
        form.reset();
        document.querySelector("#name").focus();
      },
      cacheData(formData) {
        APP.data.push(Array.from(formData.values()));
      },
      buildRow(formData) {
        const tr = document.createElement("tr");
        tr.setAttribute("data-row", document.querySelectorAll("tbody tr").length);
        let col = 0;
        for (let entry of formData.entries()) {
          tr.innerHTML += `<td data-col="${col}" data-name="${entry[0]}">${entry[1]}</td>`;
          col++;
        }
        tbody.append(tr);
      },
      exportData() {
        const headers = ["day", "time", "name", "cost", "genre"];
        const csvRows = [headers];
        APP.data.forEach((row) => {
          csvRows.push(row);
        });
        const csvString = csvRows.map(row =>
          row.map(col => col).join(",")
        ).join("\n");
        const fileName = `ãƒ‡ãƒ¼ã‚¿_${Date.now()}.csv`;
        const file = new Blob([csvString], { type: "text/csv;charset=utf-8;" });
        const a = document.createElement("a");
        a.href = URL.createObjectURL(file);
        a.download = fileName;
        a.click();
      },
      editCell(e) {
        let cell = e.target.closest("td");
        if (cell) {
          let row = +cell.parentElement.getAttribute("data-row");
          let col = +cell.getAttribute("data-col");
          cell.contentEditable = true;
          cell.focus();
          editSaveBtn.addEventListener("click", () => {
            APP.data[row][col] = cell.textContent;
            console.table(APP.data);
          });
        }
      }
    };

    document.addEventListener("DOMContentLoaded", APP.init);
  </script>
</body>
</html>
